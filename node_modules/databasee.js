const mysql = require('mysql');

const connection = mysql.createConnection({
    host: 'localhost',
    database: 'database',
    user: 'root',
    password: 'Bonbonbaby5'
});

connection.connect(function(err) {
  if (err) throw err;
  console.log('Connected to database!');
  
  // Users table - 
  connection.query(`CREATE TABLE Users (
    User_id INTEGER PRIMARY KEY,
    username VARCHAR(20),
    password VARCHAR(8),
    latitude DECIMAL(10, 8),
    longitude DECIMAL(11, 8)
  )`, function (error, results, fields) {
    if (error) throw error;
    console.log('Users table created successfully!');
  });
  
  //  Requests table
  connection.query(`CREATE TABLE Requests (
    request_id INTEGER PRIMARY KEY,
    user_id INTEGER REFERENCES Users(user_id),
    ambulance_id INTEGER REFERENCES Ambulances(ambulance_id),
    timestamp DATETIME,
    status ENUM('requested', 'accepted', 'cancelled', 'completed')
  )`, function (error, results, fields) {
    if (error) throw error;
    console.log('Requests table created successfully!');
  });
  
  //  Hospitals table
  connection.query(`CREATE TABLE Hospitals (
    hospital_id INTEGER PRIMARY KEY,
    hospital_name VARCHAR(255),
    address VARCHAR(255),
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8),
    CONSTRAINT fk_requests_address FOREIGN KEY (address) REFERENCES Requests(address)
  )`, function (error, results, fields) {
    if (error) throw error;
    console.log('Hospitals table created successfully!');
  });
  
  // Ambulances table
  connection.query(`CREATE TABLE Ambulances (
    ambulance_id INTEGER PRIMARY KEY,
    hospital_id INTEGER REFERENCES Hospitals(hospital_id),
    availability BOOLEAN,
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8)
  )`, function (error, results, fields) {
    if (error) throw error;
    console.log('Ambulances table created successfully!');
  });

  connection.end();
});

module.exports = connection